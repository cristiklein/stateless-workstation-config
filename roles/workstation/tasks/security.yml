- name: Install security tools
  apt:
    name: "{{ packages }}"
  vars:
    packages:
    - keepassx
    - passwordmaker-cli # legacy, new passwords are on keepassx
  become: true

- name: Create authorized_keys
  copy:
    content: |
      # DO NOT EDIT! This file is managed by Ansible.
      {% for sshkey in sshkeys %}
      {{ sshkey }}
      {% endfor %}
    dest: "$HOME/.ssh/authorized_keys"

- name: Setup ssh server
  apt:
    name: "{{ packages }}"
  vars:
    packages:
    - openssh-server
    - fail2ban
  become: true

- name: Configure PassworkMaker CLI
  template:
    src: passwordmaker.rdf.j2
    dest: $HOME/.passwordmaker.rdf
